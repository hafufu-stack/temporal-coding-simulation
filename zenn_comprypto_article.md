---
title: "完全な乱数は可能か？SNNによる次世代鍵作成に挑む"
emoji: "🧠"
type: "tech"
topics: ["python", "snn", "暗号", "機械学習", "numba"]
published: false
---

## はじめに：人間は「適当な数」を思いつけない

「適当な数字を思い浮かべてください」

そう言われたとき、あなたは本当にランダムな数を出せていますか？

実は、人間の脳は**サイコロを振っているわけではありません**。過去の記憶、直前の刺激、その瞬間の脳の状態…それらが複雑に絡み合って「決定的」に出力が決まっています。

これを数学・物理学では**「決定的カオス（Deterministic Chaos）」**と呼びます。

では、このカオスを**暗号の鍵生成**に使えないか？

本記事では、スパイキングニューラルネットワーク（SNN）を使って、従来とは全く異なるアプローチで暗号鍵を生成する実験について紹介します。

## 従来の乱数生成 vs 脳のカオス

### 従来の方法：計算による乱数

```python
import random
key = random.getrandbits(256)  # 256ビットの乱数
```

これは**擬似乱数**と呼ばれ、数学的なアルゴリズムで生成されます。高速で便利ですが、シード値がわかれば再現可能です。

### 新しいアプローチ：振る舞いによるカオス

```python
# ニューロンの膜電位からカオス鍵を生成
state_values = np.array([neuron.v for neuron in reservoir.neurons])
key_byte = hashlib.sha256(state_values.tobytes()).digest()[0]
```

こちらは**ニューロンの状態**を鍵に使います。膜電位は入力データの履歴に依存して刻一刻と変化するため、同じ鍵を再現するには**全く同じ入力履歴**が必要になります。

## 修論からのヒント：MD-LD相互作用

私の修士論文では、海馬歯状回の顆粒細胞をシミュレーションしました。

この細胞には2種類の入力があります：
- **MD入力**：空間情報を運ぶ（短期抑圧 = Depression）
- **LD入力**：非空間情報を運ぶ（短期増強 = Facilitation）

重要な発見は、**入力のタイミング（位相差）によって出力が劇的に変わる**ということでした。

これを暗号に応用すると：
- **データ → MD入力**
- **秘密鍵 → LD入力**
- **正しいタイミングでないと復号できない = 時間軸上の鍵**

## 実装：SNN Comprypto

### コンセプト

1. **予測圧縮**：SNNがデータの文脈を学習・予測し、予測誤差のみを記録
2. **カオス暗号化**：ニューロン膜電位のカオス的変動を鍵生成に利用
3. **同時処理**：圧縮と暗号化を1ステップで実行

### コード例

```python
class CompryptoReservoir:
    """
    予測と暗号化を同時に行うSNNリザーバ
    """
    def get_keystream_byte(self):
        """膜電位からカオス鍵を生成"""
        # 全ニューロンの膜電位を取得
        state_values = np.array([n.v for n in self.neurons])
        # ハッシュ関数で非線形性を極大化
        h = hashlib.sha256(state_values.tobytes()).digest()
        return h[0]
```

### ベンチマーク結果

Numbaによる高速化で、純粋なPython実装から**7.5倍**の速度向上を達成しました。

```
[Python版] 970ms → [Numba版] 150ms
セキュリティ: Entropy 7.96 bits/byte（理想値8.0に近い）
復元: 100%完全復元（Lossless）
```

### 処理フローの可視化

![グラフ](/images/comprypto_graph.png)
*comprypto_system.py 実行時の出力グラフ*

上のグラフは3つの段階を示しています：

1. **①入力信号とSNNの予測（上段）**
   - 青線：元の正弦波データ
   - 橙線（破線）：SNNが予測した次の値
   - SNNが波形のパターンを学習し、次の値を予測している様子がわかります

2. **②予測残差（中段）**
   - 緑線：「実際の値 - 予測値」の差分
   - 予測が正確であるほど、この値は0に近づきます
   - 0付近に集中 = エントロピー低下 = **圧縮効果**

3. **③暗号化出力（下段）**
   - 赤線：カオス鍵でXOR処理した最終出力
   - 完全にランダムに見える = **暗号化成功**
   - 秘密鍵がないと元のパターンを推測できない

暗号の強度を測る重要な指標に「アバランチ効果」があります。

鍵が1ビットでも違うと、出力が完全に変わる必要があります。

```
正しい鍵での復号: 100% 一致
1ビット違う鍵での復号: 0.70% 一致（ほぼ乱数）
```

SNNのカオス的ダイナミクスにより、わずかな鍵の違いでも出力が完全に乱数化されることを確認しました。

## まとめと今後の展望

### 達成したこと
- SNNによる圧縮・暗号化の同時処理を実現
- Numbaで7.5倍の高速化
- 高いアバランチ効果を確認
- **🎉 NIST SP 800-22 乱数検定を全テスト合格！**

### NIST検定結果

```
テスト名                         P値       判定
────────────────────────────────────────────────
Frequency (Monobit)              0.621790   ✅ PASS
Block Frequency                  0.327433   ✅ PASS
Runs                             0.249386   ✅ PASS
Longest Run                      0.841349   ✅ PASS
Matrix Rank                      0.500000   ✅ PASS
DFT (Spectral)                   0.131301   ✅ PASS
Overlapping Template             0.464884   ✅ PASS
Approximate Entropy              0.890502   ✅ PASS
Cumulative Sums                  0.267775   ✅ PASS
────────────────────────────────────────────────
結果: 9個 合格 / 9個中
```

NIST SP 800-22は、暗号業界で**世界標準**として認められている乱数検定です。
SNN Compryptoが生成する鍵ストリームは、AESなどの商用暗号と同等のランダム性を持つことが証明されました。

### 今後の目標
- GPU (CUDA) 対応による更なる高速化
- Tsodyks-Markramモデルによる本格版の完成
- ライブラリ化 (`pip install snn-comprypto`)

## リポジトリ

https://github.com/hafufu-stack/neural-coding-simulation

## 参考文献

- Tsodyks, M., & Markram, H. (1998). The neural code between neocortical pyramidal neurons depends on neurotransmitter release probability.
- 拙著修士論文「微分方程式を用いた神経情報処理への数理的アプローチ」

---

**「計算による乱数」から「振る舞いによるカオス」へ。**

生物の脳が持つ "予測不能なゆらぎ" を、次世代のセキュリティに活かす挑戦は続きます。
